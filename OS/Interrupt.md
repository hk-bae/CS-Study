# μΈν„°λ½νΈ(Interrupt)

## 1. Interrupt

### 1-1. μ •μ

* ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•λ” λ„μ¤‘μ— μκΈ°μΉ μ•μ€ μƒν™©μ΄ λ°μƒν•  κ²½μ° ν„μ¬ μ‹¤ν–‰μ¤‘μΈ μ‘μ—…μ„ μ¦‰μ‹ μ¤‘λ‹¨ν•κ³ , λ°μƒλ μƒν™©μ— λ€ν• μ°μ„  μ²λ¦¬κ°€ ν•„μ”ν•¨μ„ CPUμ—κ² μ•λ¦¬λ” μ—­ν• 

* μ§€κΈ μν–‰ μ¤‘μΈ μΌλ³΄λ‹¤ λ” μ¤‘μ”ν•μΌ(ex. μ…μ¶λ ¥, μ°μ„  μμ„ μ—°μ‚° λ“±)μ΄ λ°μƒν•λ©΄ κ·Έ μΌμ„ λ¨Όμ € μ²λ¦¬ν•κ³  λ‚μ„ ν•λ μΌμ„ κ³„μ†ν•΄μ•Ό ν•λ‹¤.

* **λΉ„λ™κΈ°μ μΌλ΅ λ°μƒν•λ” μ£Όλ³€ μ¥μΉμ μ„λΉ„μ¤ μ”μ²­μ— CPUκ°€ κ°€μ¥ λΉ λ¥΄κ² λ€μ‘ν•  μ μλ” λ°©λ²•**

* μΈν„°λ½νΈλ” ν¬κ²  `λ‚΄λ¶€ μΈν„°λ½νΈ`,`μ™Έλ¶€ μΈν„°λ½νΈ`, `μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ` λ΅ λ‚λ μ μλ‹¤.

  * **λ‚΄λ¶€ μΈν„°λ½νΈ**

    * **CPU λ‚΄λ¶€μ ν•λ“μ›¨μ–΄ μ‹ νΈμ— μν•΄ λ°μƒ**

    * `Trap`μ΄λΌκ³  λ¶λ¦¬λ©°, μλ»λ λ…λ Ήμ΄λ‚ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•  λ• λ°μƒν•λ” μΈν„°λ½νΈ

      * CPUκ°€ μ–΄λ–¤ λ…λ Ήμ„ μν–‰ν•λ ¤κ³  ν•λ”λ° κ·Έ λ…λ Ήμ΄ μν–‰ν•  μ μ—†λ” λ…λ ΉμΈ κ²½μ° CPUλ” μκΈ° μμ‹ ν•ν… μΈν„°λ½νΈλ¥Ό κ±΄λ‹¤. μ΄λ¥Ό Exception μ΄λΌκ³  ν•λ‹¤.

    * **Division by 0 , Overflow, Exception**

      

  

  * **μ™Έλ¶€ μΈν„°λ½νΈ**

    * **CPUμ μ™Έλ¶€ ν•λ“μ›¨μ–΄ μ‹ νΈμ— μν•΄ λ°μƒ**

    * μ…μ¶λ ¥ μ¥μΉ, νƒ€μ΄λ° μ¥μΉ, μ „μ› λ“± μ™Έλ¶€μ μΈ μ”μΈμΌλ΅ μΈν•΄ λ°μƒν•λ” μΈν„°λ½νΈ

    * **μ „μ› μ΄μƒ** : μ •μ „, νμ› μ΄μƒ λ“±

      * νμ› κ³µκΈ‰μ— μ΄μƒμ΄ μƒκΈ°λ©΄ μ΄λ¥Ό κ°μ§€ν•κ³  μΈν„°λ½νΈλ¥Ό λ³΄λ‚΄μ–΄ κ°‘μκΈ° μ „μ›μ΄ κΊΌμ Έ λ©”λ¨λ¦¬κ°€ λ‚ λΌκ°€λ” λ¶μƒμ‚¬λ¥Ό λ§‰μ•„μ¤€λ‹¤.

    * **κΈ°κ³„μ΄μƒ**

    * **μ…μ¶λ ¥**

      * I/O μ¥μΉλ“¤λ΅λ¶€ν„° λ°μƒν•λ” μΈν„°λ½νΈ  

    * **νƒ€μ΄λ¨Έ**

      * CPU μ¤μΌ€μ¤„λ§κ³Ό κ΄€λ ¨
      *  νƒ€μ΄λ¨Έκ°€ CPUμ—κ²  μ£ΌκΈ°μ μΌλ΅ μΈν„°λ½νΈλ¥Ό λ³΄λ‚΄μ¤€λ‹¤.

      

  * **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ**

    * **λ…λ Ήμ–΄μ μν–‰μ— μν•΄ λ°μƒ**
    * **SVC (Suprevisor Call)** ( = system call )
      * SVCλ” ν”„λ΅μ„Έμ„ λ…λ Ήμ–΄λ¥Ό μν–‰ μ‹μ—  ν”„λ΅μ„Έμ„κ°€ μ΄μμ²΄μ λ¥Ό κ΄€λ¦¬κ°λ…ν•λ” ν”„λ΅κ·Έλ¨(supervisor)μ—κ² μ μ–΄κ¶μ„ λ„κ²¨μ„ ν•΄κ²°ν•λ” κ²ƒμ„ λ§ν•λ‹¤.
      * μ‚¬μ©μκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ μ‹ν‚¤κ±°λ‚ κ°μ‹ν”„λ΅κ·Έλ¨μ„ νΈμ¶ν•λ” λ™μ‘μ„ μν–‰ν•λ” κ²½μ°
      * λ³µμ΅ν• μ…μ¶λ ¥μ„ μ²λ¦¬ν•λ” κ²½μ°
      * μ†ν”„νΈμ›¨μ–΄ μ΄μ© μ¤‘μ— λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤λ¥Ό μ‹¤ν–‰μ‹ν‚¤λ©΄ μ‹λ¶„ν•  μ²λ¦¬λ¥Ό μ„ν•΄ μμ› ν• λ‹Ή λ™μ‘μ΄ μν–‰λλ‹¤.



* **μΈν„°λ½νΈ μ°μ„ μμ„**
  * μ „μ› μ΄μƒ > κΈ°κ³„μ°©μ¤ > μ™Έλ¶€ μ‹ νΈ > μ…μ¶λ ¥ > λ…λ Ήμ–΄ μλ» > ν”„λ΅κ·Έλ¨ κ²€μ‚¬ > SVC
  * μΌλ°μ μΌλ΅ **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ(λ‚΄λ¶€,μ™Έλ¶€ μΈν„°λ½νΈ) > μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ**μ΄κ³  **μ™Έλ¶€ μΈν„°λ½νΈ > λ‚΄λ¶€ μΈν„°λ½νΈ**



### 1-2. μΈν„°λ½νΈκ°€ μ™ ν•„μ”ν• κΉ?

* μ£Ό ν”„λ΅κ·Έλ¨μ΄ μ‹¤ν–‰λλ‹¤κ°€ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ ν„μ¬ μν–‰ μ¤‘μΈ ν”„λ΅κ·Έλ¨μ„ λ©μ¶”κ³ , μƒνƒ λ μ§€μ¤ν„°μ™€ PCλ“±μ„ μ¤νƒμ— μ μ‹ μ €μ¥ν• λ’¤μ— `μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄`μΌλ΅ κ°„λ‹¤.

  

* λ§μ•½ μΈν„°λ½νΈκ°€ μ—†λ‹¤λ©΄?

  * CPUλ” νΉμ •ν• μ–΄λ–¤ μΌμ„ ν•  μ‹κΈ°λ¥Ό μ•κΈ° μ„ν•΄ κ³„μ† μ²΄ν¬λ¥Ό ν•΄μ•Ό ν•λ‹¤. (μ΄λ¥Ό `ν΄λ§(Polling)` μ΄λΌ ν•λ‹¤.)

    * μλ¥Ό λ“¤μ–΄ μ…μ¶λ ¥ μ΄λ²¤νΈκ°€ μ‹μ‘λμ—λ”μ§€ λλ” λλ‚¬λ”μ§€λ¥Ό κ³„μ†ν•΄μ„ μ²΄ν¬λ¥Ό ν•΄μ•Ό ν•λ‹¤.

      

* μ»¨νΈλ΅¤λ¬κ°€ μ…λ ¥μ„ λ°›μ•„λ“¤μ΄λ” λ°©λ²•(**μ°μ„ μμ„ νλ³„λ°©λ²•**)μ—λ” `ν΄λ§ λ°©μ‹` κ³Ό `μΈν„°λ½νΈ λ°©μ‹` μ΄ μλ‹¤.

  * **ν΄λ§ λ°©μ‹(Polling)** - S/W μ μΈ λ°©λ²•

    * μ‚¬μ©μκ°€ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄ μ…λ ¥ ν•€μ κ°’μ„ κ³„μ† μ½μ–΄ λ³€ν™”λ¥Ό μ•μ•„λ‚΄λ” λ°©μ‹

    * μΈν„°λ½νΈ μ”μ²­ ν”λκ·Έλ¥Ό μ°¨λ΅€λ΅ λΉ„κµν•μ—¬ μ°μ„ μμ„κ°€ κ°€μ¥ λ†’μ€ μΈν„°λ½νΈ μμ›μ„ μ°Ύμ•„ μ΄μ— λ§λ” μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄μ„ μν–‰ν•λ‹¤.

      * μ†λ„κ°€ λΉ λ¥Έ μ¥μΉμ— λ†’μ€ λ“±κΈ‰μ„ λ¶€μ—¬ ν•λ‹¤.

    * μ°μ„ μμ„ λ³€κ²½μ΄ μ‰½λ‹¤. π‘

    * νλ΅κ°€ κ°„λ‹¨ν•κ³  μµν†µμ„±μ΄ μμΌλ©°, λ³„λ„μ ν•λ“μ›¨μ–΄κ°€ ν•„μ” μ—†λ‹¤ π‘

    * λ§μ€ μΈν„°λ½νΈκ°€ μμ„ κ²½μ° ν•λ“μ›¨μ–΄μ μΈ λ°©λ²•μ— λΉ„ν•΄ μ°μ„ μμ„ νλ‹¨ μ†λ„κ°€ λλ¦¬λ‹¤. π­

    * Polling μ£ΌκΈ°κ°€ μ§§μΌλ©΄ μ„λ²„ μ„±λ¥μ— λ¶€λ‹΄μ΄ μƒκΈ°λ©°, μ£ΌκΈ°κ°€ κΈΈμ–΄μ§€λ©΄ μ‹¤μ‹κ°„μ„±μ΄ λ–¨μ–΄μ§„λ‹¤. π­

      

  * **μΈν„°λ½νΈ λ°©μ‹(Vectored Interrupt)** - H/W μ μΈ λ°©λ²•

    * μΈν„°λ½νΈλ¥Ό μ”μ²­ν•  μ μλ” μ¥μΉμ™€ CPU μ‚¬μ΄μ— μ¥μΉλ²νΈλ¥Ό μ‹λ³„ν•  μ μλ” λ²„μ¤λ¥Ό μ§λ ¬/λ³‘λ ¬λ΅ μ—°κ²°ν•λ‹¤.
    * μΈν„°λ½νΈ λ°±ν„°λ” **μΈν„°λ½νΈλ¥Ό λ°μƒν• μ¥μΉκ°€ λ¶„κΈ°ν•  κ³³μ— λ€ν• μ •λ³΄**μ΄λ‹¤.
    * μ†ν”„νΈμ›¨μ–΄ μ μΈ λ°©λ²•μ— λΉ„ν•΄ λΉ„κ²½μ μ μ΄λ‹¤ π­
    * νλ΅κ°€ λ³µμ΅ν•κ³  μµν†µμ„±μ΄ μ—†λ‹¤. π­
    * λ³„λ„μ μ†ν”„νΈμ›¨μ–΄κ°€ ν•„μ” μ—†μ΄ ν•λ“μ›¨μ–΄λ΅ μ²λ¦¬λλ―€λ΅ μ†λ„κ°€ λΉ λ¥΄λ‹¤.π‘

    

  * μΈν„°λ½νΈ λ°©μ‹μ€ ν•λ“μ›¨μ–΄λ΅ μ§€μ›μ„ λ°›μ•„μ•Ό ν•λ” μ μ•½μ΄ μμ§€λ§, ν΄λ§μ— λΉ„ν•΄ μ‹ μ†ν• λ€μ‘μ΄ κ°€λ¥ν•λ‹¤. λ”°λΌμ„ **μ‹¤μ‹κ°„ λ€μ‘**μ΄ ν•„μ”ν•  λ• ν•„μμ μΈ κΈ°λ¥μ΄λ‹¤.

  * μ¦‰ μΈν„°λ½νΈλ” **λ°μƒμ‹κΈ°λ¥Ό μμΈ΅ν•κΈ° νλ“  κ²½μ°μ— μ»¨νΈλ΅¤λ¬κ°€ κ°€μ¥ λΉ λ¥΄κ² λ€μ‘ν•  μ μλ” λ°©λ²•μ΄λ‹¤.**





## 2. I/O Operation Handling

### 2-1. Computer System Operation

<img width="648" alt="image" src="https://user-images.githubusercontent.com/68215452/133606325-25e3db3c-775b-4586-a702-101fb033781d.png">





* κ° **Device Controller(DC)** λ” νΉμ • μ¥μΉ μ ν•μ„ λ‹΄λ‹Ήν•λ‹¤.

* κ° DCλ” **local buffer**λ¥Ό κ°–λ”λ‹¤.

  * DCλ” μ¥μΉμ™€ λ΅μ»¬ λ²„νΌκ°„μ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  μ μλ‹¤.

* μ…μ¶λ ¥(I/O)μ€ λ””λ°”μ΄μ¤μ—μ„ λ΅μ»¬λ²„νΌμ—μ„ λ””λ°”μ΄μ¤λ΅ λ””λ°”μ΄μ¤μ—μ„ λ΅μ»¬λ²„νΌλ΅ μ „μ†΅λλ‹¤.

* λ©”μΈ λ©”λ¨λ¦¬μ™€ λ΅μ»¬ λ²„νΌ μ‚¬μ΄μ λ°μ΄ν„° μ „μ†΅μ€ CPUκ°€ λ‹΄λ‹Ήν•λ‹¤.

  * κ° **Device Driver**κ°€ OSμ™€ DCκ°„μ ν†µμ‹ μ„ λ•λ”λ‹¤.

    * μ»¤λ„μ— μ„μΉν•΄ μλ‹¤.

    * Device Driverλ” μ»¨νΈλ΅¤λ¬μ™€ μ»¤λ„μ‚¬μ΄μ κ· μΌν• μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•¨μΌλ΅μ„ DCμ κΈ°λ¥μ„ μ¶”μƒν™”ν•΄μ¤€λ‹¤.

    * DCλ” I/O μ‘μ—…μ΄ λλ‚¬μμ„ Device Driverμ— μ•λ¦°λ‹¤.

      

### 2-2. Programmed I/O (a.k.a polling)

* CPUλ” DCλ¥Ό ν†µν•΄μ„ **I/O μ¥μΉμ μƒνƒλ¥Ό λ°λ³µμ μΌλ΅ μ κ²€**

  * μ¥μΉκ°€ I/O μ‘μ—…μ„ μν–‰ν•  μ¤€λΉ„κ°€ λμ—λ”μ§€? μ”μ²­λ I/O μ‘μ—…μ΄ μ™„λ£ λμ—λ”μ§€?

* μƒνƒκ°€ μ¤€λΉ„λλ©΄ CPUκ°€ I/O μ‘μ—…μ— ν•„μ”ν• λ°μ΄ν„°λ¥Ό μ§μ ‘ μ΄λ™ν•λ‹¤.

  * CPUλ” ν•­μƒ I/O μ‘μ—…μ„ μ²λ¦¬ν•λ”λ° κ΄€μ—¬λλ‹¤.

  * CPUκ°€ I/O μ¥μΉκ°€ μ¤€λΉ„λκΈ°λ¥Ό κΈ°λ‹¤λ¦¬λ” λ° μƒλ‹Ήν• μ‹κ°„μ΄ λ‚­λΉ„λμ–΄(**busy waiting**) CPU λ¦¬μ†μ¤κ°€ λΉ„ν¨μ¨μ μΌλ΅ μ‚¬μ©λ  μ μλ‹¤.

    

### 2-3. Interrupt-driven I/O

* DCκ°€ μΈν„°λ½νΈλ¥Ό μƒμ„±ν•μ—¬ CPUμ— μ΄λ²¤νΈλ¥Ό μ•λ¦°λ‹¤!
  * I/O μ¥μΉμ—μ„ μμ‹  μ”μ²­μ΄ λ„μ°©ν•  λ•, I/O μ‘μ—…μ΄ λλ‚¬μ„ λ•



* μΈν„°λ½νΈ μ²λ¦¬ ν”„λ΅μ„Έμ¤

  <img width="314" alt="image" src="https://user-images.githubusercontent.com/68215452/133606343-fe1b37a1-32a3-4c16-ba22-3f58809ffc80.png">

  
  
  1. μΈν„°λ½νΈκ°€ λ°μƒν•λ‹¤.
  2. μ‹μ¤ν…μ€ CPUμ ν„μ¬ μƒνƒλ¥Ό μ €μ¥ν•λ‹¤.
     * μΈν„°λ½νΈ μ²λ¦¬ ν›„ ν„μ¬ μƒνƒλ΅ λμ•„μ¤κ² λλ‹¤.
     * λ μ§€μ¤ν„°λ“¤κ³Ό μ¤‘λ‹¨λ λ…λ Ήμ μ£Όμ†λ¥Ό μ €μ¥ν•λ‹¤.
     * HW λλ” μ΄μμ²΄μ μ—μ„ μν–‰
  3. μ§€μ •λ **μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(ISR) λλ” μΈν„°λ½νΈ ν•Έλ“¤λ¬λ΅ μ΄λ™**ν•λ‹¤.
     * **μΈν„°λ½νΈ λ°±ν„°**μ— λ¨λ“  μ„λΉ„μ¤ λ£¨ν‹΄μ μ£Όμ†κ°€ ν¬ν•¨λμ–΄ μλ‹¤.
  4. λ μ§€μ¤ν„°λ“¤μ„ λ³µμ›ν•μ—¬ λ§μ§€λ§‰ μƒνƒλ΅ λλλ¦°λ‹¤.



* CPUκ°€ busy waitingμ„ ν•  ν•„μ”κ°€ μ—†κΈ° λ•λ¬Έμ— Programmed I/O(Polling) λ³΄λ‹¤ λ” ν¨μ¨μ μ΄λ‹¤.
* ν•μ§€λ§ λ€λ‰μ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•  κ²½μ° CPUκ°€ μ—¬μ „ν λ§μ€ λ¶€ν•λ¥Ό λ°›κ²λλ‹¤.
  * DCμ™€ main memory μ‚¬μ΄μ λ°μ΄ν„° μ „μ†΅μ„ CPUκ°€ λ‹΄λ‹Ήν•κΈ° λ•λ¬Έ



### 2-4. Direct Memory Access(DMA) I/O

* I/O μ‘μ—…μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ `DMA μ»¨νΈλ΅¤λ¬` λΌλ” ν•λ“μ›¨μ–΄λ¥Ό μ‚¬μ©ν•λ‹¤.
  * CPUκ°€ I/O μ‘μ—…μ„ DMA μ»¨νΈλ΅¤λ¬μ—κ² μ”μ²­ν•λ‹¤.
  * DMA μ»¨νΈλ΅¤λ¬κ°€ **CPU κ°μ… μ—†μ΄ DCμ™€ λ©”μΈ λ©”λ¨λ¦¬ κ°„μ λ°μ΄ν„° μ „μ†΅μ„ μν–‰**ν•λ‹¤.
  * DMA μ»¨νΈλ΅¤λ¬κ°€ μΈν„°λ½νΈλ¥Ό μƒμ„±ν•μ—¬ CPUμ—κ² μ‘μ—…μ΄ μ™„λ£λμ—μμ„ μ•λ¦°λ‹¤.



* CPUλ” I/O μ‘μ—…μ΄ μ²λ¦¬λλ” λ™μ• λ‹¤λ¥Έ μ‘μ—…μ„ μν–‰ν•κ³  μμ„ μ μλ‹¤.
* High Speed I/O μ¥μΉμ— μ‚¬μ©λλ©° λ©”λ¨λ¦¬ μ†λ„μ— κ°€κΉμ΄ μ†λ„λ΅ μ •λ³΄ μ „μ†΅μ— μ‚¬μ©λλ‹¤.



* **DMA I/O : Read Operation**

  <img width="684" alt="image" src="https://user-images.githubusercontent.com/68215452/133606363-7bf73275-8cc6-4e34-95bd-c15c349aaffb.png">



* **DMA I/O : Write Operation**

  <img width="649" alt="image" src="https://user-images.githubusercontent.com/68215452/133606568-c9d2b2b6-cfed-4696-8b88-e3f2ec726381.png">
  
  

---

* μ°Έκ³ μλ£
  * μ•„μ£Όλ€ν•™κµ μ¤μƒμ€ κµμλ‹ μ΄μμ²΄μ  κ°•μμλ£
  * https://jhnyang.tistory.com/167
  * https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Interrupt.md
  * https://github.com/Songwonseok/CS-Study/blob/main/OS/Interrupt.md